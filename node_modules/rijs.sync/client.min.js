var sync=function(){"use strict";function n(n){return function(t){return t==n}}function t(n){return function(t){return x(t)(n)}}function e(n){return function(t){return t==n}}function r(n,t,e,u){var i=e.shift();if(!k[t])return!1;if(e.length){if(!(i in n)){if("remove"==t)return!0;n[i]={}}return r(n[i],t,e,u)}return k[t](n,i,u),!0}function u(n){return function(t){return L(t)(n)}}var i=function(){var n,t,e=new Promise(function(e,r){n=e,t=r});return arguments.length&&n(arguments[0]),e.resolve=n,e.reject=t,e},o=function n(t,e){return e instanceof Array&&(e=e.reduce(n,[])),(t=t||[]).concat(e)},f=function(n,t){return t in n},c=function(n,t,e,r){return n.host&&n.host.nodeName&&(n=n.host),t.name&&(e=t,t=t.name),!f(n,t)&&Object.defineProperty(n,t,{value:e,writable:r}),n[t]},a=function n(t){function e(n,e){return n.next?n.next(e):e instanceof Array?n.apply(t,e):n.call(t,e)}function r(n,t){for(var e=n.length;~--e;)t!=n[e]&&t!=n[e].fn&&t||n.splice(e,1)}function u(t,e){var o=n((e=e||{}).base||i());return o.i=0,o.li=[],o.fn=e.fn,o.parent=t,o.source=e.fn?o.parent.source:o,o.on("stop",function(){return o.type?o.parent.off(o.type,o):o.parent.off(o)}),o.each=function(n){var t=n.next?n:u(o,{fn:n});return o.li.push(t),t},o.pipe=function(n){return n(o)},o.map=function(n){return o.each(function(t,e,r){return r.next(n(t,e,r))})},o.filter=function(n){return o.each(function(t,e,r){return n(t,e,r)&&r.next(t)})},o.reduce=function(n,t){return o.each(function(e,r,u){return u.next(t=n(t,e,r,u))})},o.unpromise=function(){var n=u(o,{base:{},fn:function(t){return n.next(t)}});return o.li.push(n),n},o.next=function(n){return o.resolve&&o.resolve(n),o.li.length?o.li.map(function(t){return t.fn(n,t.i++,t)}):n},o.until=function(n){return n.each(function(){o.source.emit("stop")}),o},o.off=function(n){return r(o.li,n),o},o[Symbol.asyncIterator]=function(){return{next:function(){return o.wait=new Promise(function(n){o.wait=!0,o.map(function(t,e,r){delete o.wait,o.off(r),n({value:t,done:!1})}),o.emit("pull",o)})}}},o}return t=t||{},c(t,"emit",function(n,r,u){for(var i=t.on[n.split(".")[0]]||[],f=[],c=0;c<i.length;c++)i[c].ns&&u&&!u(i[c].ns)||f.push(e(i[c].isOnce?i.splice(c--,1)[0]:i[c],r));for(c=0;c<t.on["*"].length;c++)f.push(e(t.on["*"][c],[n,r]));return f.reduce(o,[])},1),c(t,"once",function(n,e){return t.on(n,e,!0)},1),c(t,"off",function(n,e){return r(t.on[n]||[],e),e&&e.ns&&delete t.on[n]["$"+e.ns],t},1),c(t,"on",function(n,e,i){function o(n){return n.isOnce=i,n.type=f,c&&(t.on[f]["$"+(n.ns=c)]=n),a.push(n),n.next?n:t}var f=n.split(".")[0],c=n.split(".")[1],a=t.on[f]=t.on[f]||[],s="function"==typeof e?e:0;return!s&&c?(s=t.on[f]["$"+c])?s:o(u(t,e)):s||c?s&&c?o((r(a,t.on[f]["$"+c]||-1),s)):!(!s||c)&&o(s):o(u(t,e))},1),t.on["*"]=t.on["*"]||[],t},s=function(n){void 0===n&&(n=location.href.replace("http","ws"));var t=a({attempt:0});return t.ready=t.once("connected"),t.connect=d(t,n),t.connect(),t.send=function(n){return t.ready.then(function(t){return t.send(n)})},t},p=Math.min,l=Math.pow,d=function(n,t){return function(){var e=window.WebSocket,r=window.setTimeout,u=new e(t);u.onopen=function(){return n.emit("connected",u)},u.onmessage=function(t){return n.emit("recv",t.data)},u.onclose=function(){n.ready=n.once("connected"),n.emit("disconnected"),r(n.connect,m(++n.attempt))}}},m=function(n,t,e){return void 0===t&&(t=100),void 0===e&&(e=1e4),p(e,t*l(2,n))},v=n;n.fn=function(n){return"function"==typeof n},n.str=function(n){return"string"==typeof n},n.num=function(n){return"number"==typeof n},n.obj=function(n){return"object"==typeof n},n.lit=function(n){return"object"==typeof n&&!(n instanceof Array)},n.bol=function(n){return"boolean"==typeof n},n.truthy=function(n){return 1==!!n},n.falsy=function(n){return 0==!!n},n.arr=function(n){return n instanceof Array},n.null=function(n){return null===n},n.def=function(n){return void 0!==n},n.in=function(n){return function(t){return!!n&&(n.indexOf?~n.indexOf(t):t in n)}},n.promise=function(n){return n instanceof Promise},n.stream=function(n){return!(!n||!n.next)};var y=function(n){return Object.keys(v.obj(n)||v.fn(n)?n:{})},h=function(n){return n.__data__},b=function(n){return function(){return n}},g=function(n){return 0===n?"0":n?v.fn(n)?""+n:v.obj(n)?JSON.stringify(n):String(n):""},x=function n(t,e){var r=arguments.length>1,u=v.fn(t)?[]:g(t).split("."),i=u.shift();return function(o,f){var c={};return o?v.num(t)||t?v.arr(t)?(t.map(function(t){var e=n(t)(o);void 0!=e&&n(t,v.fn(e)?b(e):e)(c)}),c):o[t]||!u.length?r?(o[t]=v.fn(e)?e(o[t],f):e,o):v.fn(t)?t(o):o[t]:r?(n(u.join("."),e)(o[i]?o[i]:o[i]={}),o):n(u.join("."))(o[i]):o:void 0}},O=t;t.parent=function(n){return h(this.parentNode)[n]};var j=function(n){return n?y(n).map(O(n)):[]},w=function(n){void 0===n&&(n={});var t=n.socket;return void 0===t&&(t=s()),t.id=0,t.once("disconnected").map(function(){return t.on("connected").map(S(t))}),t.on("recv").map(function(n){return N(n)}).each(function(n){var e=n.id,r=n.data;return r.exec?r.exec(t.on["$"+e]&&t.on["$"+e][0],r.value):t.emit("$"+e,r)}),Object.defineProperty(z(t),"subscriptions",{get:function(){return _(t)}})},_=function(n){return j(n.on).map(function(n){return n&&n[0]}).filter(function(n){return n&&n.type&&"$"==n.type[0]})},S=function(n){return function(){return _(n).map(function(n){return n.type}).map(function(t){return n.send(n.on[t][0].subscription)})}},N=function(n,t){return t={exports:{}},n(t,t.exports),t.exports}(function(n){!function(){function t(n){return"object"==typeof n?null===n?"null":n&&1===n.nodeType?"dom":n instanceof Array?"array":n instanceof Date?"date":"object":typeof n}function e(n){var t=arguments,e=arguments.length;if(e<2||null==n)return n;for(var r=1;r<e;r++)for(var u=t[r],i=Object.keys(u),o=i.length,f=0;f<o;f++){var c=i[f];void 0===n[c]&&(n[c]=u[c])}return n}function r(n,e,u,f){u.prepare&&u.prepare(n),f=f||[];var c=t(n);if(-1!==s.indexOf(c)){var a=f.indexOf(n);if(-1===a){var l={};f[a=e.push({contents:l,value:o(n)})-1]=n;for(var d in n)u.isSerializable(n,d)&&(l[d]=r(n[d],e,u,f))}return p+a}return i(n)}function u(n,t,e,r){if(r=r||[],a(n,p)){var i=parseInt(n.slice(p.length),10);if(!r.hasOwnProperty(i)){var o=t[i],s=f(o.value),l=o.contents;r[i]=s;for(var d in l)s[d]=u(l[d],t,e,r)}return e.finalize&&e.finalize(r[i]),r[i]}return e.finalize&&e.finalize(n),c(n)}function i(n){var e=t(n);if("undefined"===e)return m;if("function"===e)return d+n.toString();if("date"===e)return v+n.getTime();if(n===1/0)return l;if("dom"!==e)return n}function o(n){var e=t(n);return"function"===e||"date"===e?i(n):"object"===e?y:"array"===e?h:n}function f(n){if("string"===t(n)){if(n===m)return;if(a(n,d))return new Function("return "+n.slice(d.length))();if(a(n,v)){var e=parseInt(n.slice(v.length),10);return new Date(e)}if(a(n,y))return{};if(a(n,h))return[];if(n===l)return 1/0}return n}function c(n){if("string"===t(n)){if(n===m)return;if(a(n,d)){var e=n.slice(d.length),r=e.indexOf("(")+1,u=e.indexOf(")",r),i=e.slice(r,u),o=e.indexOf("{")+1,f=e.lastIndexOf("}")-1,c=e.slice(o,f);return new Function(i,c)}if(a(n,v)){var s=parseInt(n.slice(v.length),10);return new Date(s)}if(n===l)return 1/0}return n}function a(n,e){return"string"===t(n)&&n.slice(0,e.length)===e}var s="object array date function".split(" "),p="_CRYO_REF_",l="_CRYO_INFINITY_",d="_CRYO_FUNCTION_",m="_CRYO_UNDEFINED_",v="_CRYO_DATE_",y="_CRYO_OBJECT_",h="_CRYO_ARRAY_",b={stringify:function(n,t){var u=[],i=r(n,u,t=e((t="function"==typeof t?{prepare:t}:t)||{},{prepare:null,isSerializable:function(n,t){return n.hasOwnProperty(t)}}));return JSON.stringify({root:i,references:u})},parse:function(n,t){var r=JSON.parse(n);return t="function"==typeof t?{finalize:t}:t,t=e(t||{},{finalize:null}),u(r.root,r.references,t)}},g=this;n.exports?n.exports=b:g.Cryo=b}()}).parse,z=function(n,t){return function(e,r){if(e instanceof window.Blob)return A(n,e,r);var u=g(++n.id),i=n.on("$"+u),o=function(e,r){return void 0===r&&(r=0),n.send(i.source.subscription=g({id:u,data:e,type:t})).then(function(){return i.emit("sent",{id:u,count:r})})};return e.next?e.map(o).source.emit("start"):o(e),i.source.once("stop").filter(function(n){return"CLOSED"!=n}).map(function(){return z(n,"UNSUBSCRIBE")(u).filter(function(n,t,e){return e.source.emit("stop","CLOSED")})}),i}},A=function(n,t,e,r,u){void 0===r&&(r=0),void 0===u&&(u=1024);var i=a().on("recv"),o=function(e){return function(){return r>=t.size?i.emit("sent",{id:e}):(n.send(t.slice(r,r+=u)),window.setTimeout(o(e)))}};return z(n,"BINARY")({size:t.size,meta:e}).on("sent",function(n){var t=n.id;return o(t)()}).on("progress",function(n){return i.emit("progress",{received:n,total:t.size})}).map(i.next).source.until(i.once("stop")),i},P=e;e.fn=function(n){return"function"==typeof n},e.str=function(n){return"string"==typeof n},e.num=function(n){return"number"==typeof n},e.obj=function(n){return"object"==typeof n},e.lit=function(n){return"object"==typeof n&&!(n instanceof Array)},e.bol=function(n){return"boolean"==typeof n},e.truthy=function(n){return 1==!!n},e.falsy=function(n){return 0==!!n},e.arr=function(n){return n instanceof Array},e.null=function(n){return null===n},e.def=function(n){return void 0!==n},e.in=function(n){return function(t){return!!n&&(n.indexOf?~n.indexOf(t):t in n)}},e.promise=function(n){return n instanceof Promise},e.stream=function(n){return!(!n||!n.next)};var C={arr:function(n){return Array.prototype.slice.call(n,0)},obj:function(n){function t(n,t,r){return 0===r&&(n={}),n[P.fn(e)?e(t,r):t[e]]=t,n}var e="id";return 1==arguments.length?(e=n,t):t.apply(this,arguments)}},I=function(){var n,t,e=new Promise(function(e,r){n=e,t=r});return arguments.length&&n(arguments[0]),e.resolve=n,e.reject=t,e},R=function n(t,e){return e instanceof Array&&(e=e.reduce(n,[])),(t=t||[]).concat(e)},$=function(n,t){return t in n},E=function(n,t,e,r){return n.host&&n.host.nodeName&&(n=n.host),t.name&&(e=t,t=t.name),!$(n,t)&&Object.defineProperty(n,t,{value:e,writable:r}),n[t]},Y=function n(t){function e(n,e){return n.next?n.next(e):e instanceof Array?n.apply(t,e):n.call(t,e)}function r(n,t){for(var e=n.length;~--e;)t!=n[e]&&t!=n[e].fn&&t||n.splice(e,1)}function u(t,e){var i=n((e=e||{}).base||I());return i.i=0,i.li=[],i.fn=e.fn,i.parent=t,i.source=e.fn?i.parent.source:i,i.on("stop",function(){return i.type?i.parent.off(i.type,i):i.parent.off(i)}),i.each=function(n){var t=n.next?n:u(i,{fn:n});return i.li.push(t),t},i.pipe=function(n){return n(i)},i.map=function(n){return i.each(function(t,e,r){return r.next(n(t,e,r))})},i.filter=function(n){return i.each(function(t,e,r){return n(t,e,r)&&r.next(t)})},i.reduce=function(n,t){return i.each(function(e,r,u){return u.next(t=n(t,e,r,u))})},i.unpromise=function(){var n=u(i,{base:{},fn:function(t){return n.next(t)}});return i.li.push(n),n},i.next=function(n){return i.resolve&&i.resolve(n),i.li.length?i.li.map(function(t){return t.fn(n,t.i++,t)}):n},i.until=function(n){return n.each(function(){i.source.emit("stop")}),i},i.off=function(n){return r(i.li,n),i},i[Symbol.asyncIterator]=function(){return{next:function(){return i.wait=new Promise(function(n){i.wait=!0,i.map(function(t,e,r){delete i.wait,i.off(r),n({value:t,done:!1})}),i.emit("pull",i)})}}},i}return t=t||{},E(t,"emit",function(n,r,u){for(var i=t.on[n.split(".")[0]]||[],o=[],f=0;f<i.length;f++)i[f].ns&&u&&!u(i[f].ns)||o.push(e(i[f].isOnce?i.splice(f--,1)[0]:i[f],r));for(f=0;f<t.on["*"].length;f++)o.push(e(t.on["*"][f],[n,r]));return o.reduce(R,[])},1),E(t,"once",function(n,e){return t.on(n,e,!0)},1),E(t,"off",function(n,e){return r(t.on[n]||[],e),e&&e.ns&&delete t.on[n]["$"+e.ns],t},1),E(t,"on",function(n,e,i){function o(n){return n.isOnce=i,n.type=f,c&&(t.on[f]["$"+(n.ns=c)]=n),a.push(n),n.next?n:t}var f=n.split(".")[0],c=n.split(".")[1],a=t.on[f]=t.on[f]||[],s="function"==typeof e?e:0;return!s&&c?(s=t.on[f]["$"+c])?s:o(u(t,e)):s||c?s&&c?o((r(a,t.on[f]["$"+c]||-1),s)):!(!s||c)&&o(s):o(u(t,e))},1),t.on["*"]=t.on["*"]||[],t},k={add:function(n,t,e){P.arr(n)?n.splice(t,0,e):n[t]=e},update:function(n,t,e){n[t]=e},remove:function(n,t){P.arr(n)?n.splice(t,1):delete n[t]}},B=JSON.stringify,D=JSON.parse,T=function(n,t){return function(e,u,i){if(!P.obj(e)&&!P.fn(e))return e;if(!P.obj(n)){var o=u||e.log||[],f=e;if(P.def(i)||(i=o.max||0),i||(o=[]),i<0&&(o=o.concat(null)),i>0){var c=B(e);f=D(c),o=o.concat({type:"update",value:D(c),time:o.length})}return E(o,"max",i),f.log?f.log=o:E(Y(f),"log",o,1),f}return!!P.def(n.key)&&(!!r(e,n.type,(n.key=""+n.key).split("."),n.value)&&(e.log&&e.log.max&&e.log.push((n.time=e.log.length,e.log.max>0?n:null)),!t&&e.emit&&e.emit("change",n),e))}},F=function(n){return function(){return!n.apply(this,arguments)}},J=function(n){return function(){return n}},U=function(n){return 0===n?"0":n?P.fn(n)?""+n:P.obj(n)?JSON.stringify(n):String(n):""},L=function n(t,e){var r=arguments.length>1,u=P.fn(t)?[]:U(t).split("."),i=u.shift();return function(o,f){var c={};return o?P.num(t)||t?P.arr(t)?(t.map(function(t){var e=n(t)(o);void 0!=e&&n(t,P.fn(e)?J(e):e)(c)}),c):o[t]||!u.length?r?(o[t]=P.fn(e)?e(o[t],f):e,o):P.fn(t)?t(o):o[t]:r?(n(u.join("."),e)(o[i]?o[i]:o[i]={}),o):n(u.join("."))(o[i]):o:void 0}},M=function(n){return Object.keys(P.obj(n)||P.fn(n)?n:{})},W=function(n,t){return function(e){return t[e]=n[e],e}},q=function(n){return function(t){return M(t).filter(F(P.in(n))).map(W(t,n)),n}},G=function(n){return n.__data__},H=u;u.parent=function(n){return G(this.parentNode)[n]};var K=function(n){return n?M(n).map(H(n)):[]},Q=function(n){return function(t,e,r){return t instanceof Blob?n(t,e):n(P.obj(t)?t:{name:t,type:e,value:r})}},V=function(n){return function(t,e){if(n.subscriptions[t]=n.subscriptions[t]||{},P.arr(e))return Promise.all(e.map(function(e){return n.get(t,e)}));var r=L(e)(L("resources."+t+".body")(n));return e in n.subscriptions[t]&&r?Promise.resolve(r):n.subscribe(t,e).filter(function(n,t,e){return e.source.emit("stop")}).map(function(){return L(e)(L("resources."+t+".body")(n))})}},X=function(n,t){return function(e){return e.key||"update"!=e.type?T(e)(t in n.resources?n(t):n(t,{})):n(en(q({name:t})(e))),e}},Z=function(n){var t=Y().on("next"),e=[];return n.map(function(n,r){return n.each(function(n){e[r]=n,t.next(e)})}),t.once("stop").map(function(){return n.map(function(n){return n.source.emit("stop")})}),t},nn=function(n){return function(t,e){if(P.arr(t))return Z(t.map(function(t){return n.subscribe(t,e)}));if(n.subscriptions[t]=n.subscriptions[t]||{},P.arr(e))return Z(e.map(function(e){return n.subscribe(t,e)})).map(function(){return L(e)(n(t))});var r=Y().on("next");r.on("stop").filter(function(){return u.off(r.next)&&!u.li.length}).map(function(){return u.source.emit("stop")}).map(function(){n.subscriptions[t][e]=void 0}),n.subscriptions[t][e]&&r.on("start").map(function(){return L(e)(n(t))}).filter(P.def).map(function(n){return r.next(n)});var u=n.subscriptions[t][e]=n.subscriptions[t][e]||n.send(t,"SUBSCRIBE",e).map(X(n,t)).map(function(){return L(e)(n(t))});return u.each(r.next),r}},tn=function(n){return function(t,e){var r=++n.upload.id,u={},i=0,o=function(){if(!f.length)return!0;var t=f.shift(),e=t.field,u=t.filename,a=t.i,s=t.blob;return n.send(s,{filename:u,field:e,i:a,index:r}).on("progress",function(n){var t=n.received;return c.emit("progress",{total:i,received:i-(s.size-t)-f.reduce(function(n,t){return n+=t.blob.size},0)})}).then(o)},f=M(e).map(function(n){return u[n]=e[n],n}).filter(function(n){return e[n]instanceof FileList}).map(function(n){return u[n]=[],C.arr(e[n]).map(function(n){return i+=n.size,n}).map(function(t,e){return{field:n,filename:t.name,i:e,blob:t,sent:0}})}).reduce(R,[]),c=n.send({files:f.length,type:"PREUPLOAD",fields:u,index:r,size:i,name:t}).once("sent",o);return c}},en=function(n){var t=n.name,e=n.value;return{name:t,headers:n.headers,body:e}},rn=function(n){return function(t){return function(e){return!n.deps(e).filter(F(P.in(n.subscriptions))).map(function(t){return n.subscribe(t)}).length&&t(e)}}},un=function(n){return function(t){return K(n.types).filter(function(n){return n.extract}).map(function(n){return n.extract(t)}).reduce(function(n,t){return n.concat(t)},[]).filter(Boolean)}};return function(n,t,e){void 0===t&&(t={}),void 0===e&&(e={});var r=e.xrs;return void 0===r&&(r=w),n.send=Q(r()),n.subscribe=nn(n),n.subscriptions={},n.get=V(n),n.upload=tn(n),n.upload.id=0,n.render=rn(n)(n.render),n.deps=un(n),n}}();
